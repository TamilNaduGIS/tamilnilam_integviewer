<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow">
      <!-- Favicons -->
    <link href="assets/logo/tn-logo.png" rel="icon">
    <link href="assets/logo/tn-logo.png" rel="apple-touch-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tamil Nilam GI Viewer</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="vendor/openlayer/ol.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link href="assets/css/all.min.css" rel="stylesheet">
    <link href="assets/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="assets/css/font-gis.css" rel="stylesheet" />
    <link rel="stylesheet" href="assets/css/toastr.min.css">

    <style>
      .jsb-carousel-wrapper::-webkit-scrollbar {
    height: 6px;
}
.jsb-carousel-wrapper::-webkit-scrollbar-thumb {
    background: #aaa;
    border-radius: 5px;
}
.jsb-carousel-wrapper::-webkit-scrollbar-track {
    background: transparent;
}

        #tngisLogo{
            width: 35px!important;
            text-align: center;
            margin-top: 3rem;
            background: none!important;
        }
        
        /* Tooltip container */
        .tooltip {
                position: relative;
        }

        /* Tooltip text */
        .tooltip .tooltiptext {
            visibility: hidden;
            width: max-content;
            text-wrap: nowrap;
            background-color: rgba(119, 119, 119, 0.623);
            color: #fff;
            text-align: center;
            border-radius: 10px;
            padding: 1px 10px;
            /* Position the tooltip text - see examples below! */
            position: absolute;
            top: -3rem;
            z-index: 1;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        .tooltip:hover .tooltiptext {
            visibility: visible;
        }
        /* Spinner overlay container */
        
        .backdrop-loader {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6); /* backdrop effect */
            z-index: 1050; /* higher than most elements */
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(2px); /* optional blur effect */
        }
        .loader {
        border: 6px solid #f3f3f3;
        border-top: 6px solid #3498db;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: auto;
        position: absolute;
        top: 32%;
        left: 44%;
        transform: translate(-50%, -50%);
        z-index: 9999;
        }

        @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
        }


        

        
    </style>
</head>

<body>
    <header>
        <div class="row">
            <div class="col-sm-6 d-flex align-items-center">
                <img src="assets/logo/tn-logo.png" alt="" style="width: 50px;">
                <div id="title" class="mx-3">Tamil Nilam - GI Viewer</div>
            </div>
            <div class="col-sm-6 d-flex justify-content-end">
                <button class="toggle-menu" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasScrolling" aria-controls="offcanvasScrolling"><i class="bi bi-list"></i></button>
                <button class="filter-menu" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasScrolling-right" aria-controls="offcanvasScrolling"><i class="bi bi-funnel-fill"></i></button>
            </div>
            <input type="hidden" id="verifiedSubDivision" value="">
            <input type="hidden" id="latitude" value="">
            <input type="hidden" id="longitude" value="">
        </div>
    </header>
    <div class="legend-div" title="Legend">
        <i class="bi bi-map" id="legend-icon"></i>
    </div>
    <div class="offcanvas offcanvas-end menu show" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvasScrolling" aria-labelledby="offcanvasScrollingLabel">
        <div class="offcanvas-header">
            <h6 class="offcanvas-title" id="offcanvasScrollingLabel">Layers and Tools</h6>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <div class="accordion" id="accordionPanelsLayers">
                <div class="accordion-item">
                  <h2 class="accordion-header" id="panelsStayOpen-headingOne">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true" aria-controls="panelsStayOpen-collapseOne">
                        Basemaps
                    </button>
                  </h2>
                  <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show" aria-labelledby="panelsStayOpen-headingOne">
                    <div class="accordion-body">
                      <div class="basemap-control my-1">
                        <label class="maptype">
                            <input type="radio" class="basemap-btn" name="basemap" value="osm"  onclick="changeBasemap('basemap', 'osm')">Street Map
                        </label>
                        <label class="maptype">
                            <input type="radio" class="basemap-btn" name="basemap" value="satellite"  checked onclick="changeBasemap('basemap', 'satellite')"> Satellite
                        </label>
                        <label class="maptype">
                            <input type="radio" class="basemap-btn" name="basemap" value="terrain"  onclick="changeBasemap('basemap', 'terrain')"> Terrain
                        </label>
                        <label class="maptype">
                            <input type="radio" class="basemap-btn" name="basemap" value="nomap"  onclick="changeBasemap('basemap', 'nomap')"> No Map
                        </label>
                        
                    </div>
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="panelsStayOpen-headingThree">
                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseThree" aria-expanded="false" aria-controls="panelsStayOpen-collapseThree">
                        Thematic Map
                      </button>
                    </h2>
                    <div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingThree">
                      <div class="accordion-body">
                        <div id="thematic-layer-control" class="my-1">
                            <div class="accordion" id="accordionPanelsStayOpenExampleThematic"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="panelsStayOpen-headingTwo">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false" aria-controls="panelsStayOpen-collapseTwo">
                        Layers
                        </button>
                    </h2>
                    <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingTwo">
                        <div class="accordion-body">
                        <div id="layer-control" class="my-1">
                            <!-- Layers will be dynamically added here -->
                            <div class="accordion" id="accordionPanelsStayOpenExample"></div>
                        </div>
                        </div>
                    </div>
                </div>
                
              </div>

            
            
        </div>
    </div>
    
    <div class="gears text-center">
        <!-- Reset to Default Rotation Button -->
        <button id="legend" class="layer-btns" type="button" data-bs-toggle="modal" data-bs-target="#legendmodal" title="Legend"><i class="bi bi-card-list"></i></button>
        
       <!-- Modal -->
        <div class="modal fade" id="legendmodal" data-bs-backdrop="false" data-bs-keyboard="false" tabindex="-1" aria-labelledby="legendmodaldropLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                <h1 class="modal-title fs-5" id="legendmodaldropLabel">Legend</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="legend-content"></div>
                </div>
            </div>
            </div>
        </div>
        
        <div class="rotation layer-btns" title="Map Rotation">
            <a id="resetRotation">
                <img src="assets/logo/north-arrow-svg.svg" class="north" alt="North Arrow">
            </a>
            <div class="sub-rotate-btns">
                <button class="rotation-right" aria-label="Rotate Right" type="button">
                    <img src="assets/icons/Arrow 1.svg" alt="" id="arrows-inside">
                </button>
                <button class="rotation-left" aria-label="Rotate Left" type="button">
                    <img src="assets/icons/Arrow 2.svg" alt="" id="arrows-inside">
                </button>
            </div>

        </div>
        
        <!-- <button id="fullscreenBtn" class="layer-btns"><i class="bi bi-arrows-fullscreen"></i></button> -->
       <button id="zoom-to-extent-btn" class="layer-btns" title="Extent"><i class="bi bi-arrow-counterclockwise"></i></button>
        <!-- <button id="currentLocationBtn" class="layer-btns"><i class="bi bi-crosshair"></i></button> -->
        <button id="zoom-in-btn" class="layer-btns" title="zoom-in"><i class="bi bi-plus-circle-fill"></i></button>
        <button id="zoom-out-btn" class="layer-btns" title="Zoom-out"><i class="bi bi-dash-circle-fill"></i></button>
        <a href="https://tngis.tnega.org/" title="TNGIS" target="_blank"><img class="layer-btns" src="assets/logo/gis-logo-white.png" id="tngisLogo" alt="TNGIS-logo" srcset=""></a>
        
    </div>
    <div class="offcanvas offcanvas-end menu" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvasScrolling-right" aria-labelledby="offcanvasScrollingLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasScrollingLabel">Filter</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <div class="dropdowns">
                <div class="radio-group mt-1">
                    <label class="radio-label maptype">
                        <input type="radio" name="area-type" value="rural" checked="">
                        Rural
                    </label>
                    <label class="radio-label maptype">
                        <input type="radio" name="area-type" value="urban">
                        Urban
                    </label>
                    <label class="radio-label maptype">
                        <input type="radio" name="area-type" value="goto">
                        Goto
                    </label>
                </div>
                <select id="district-dropdown" class="form-select">
                    <option value="" disabled="" selected="">Select District</option>
                </select>
                <select id="taluk-dropdown" class="form-select">
                    <option value="" disabled="" selected="">Select Taluk</option>
                </select>

                <!-- Rural Fields -->
                <div id="rural-fields">
                    <select id="village-dropdown" class="form-select">
                        <option value="" disabled="" selected="">Select Village</option>
                    </select>

                    <select id="survey-number-dropdown" class="form-select">
                        <option value="" disabled="" selected="">Select Survey Number</option>
                    </select>

                    <select id="sub-division-dropdown" class="form-select">
                        <option value="" disabled="" selected="">Select Sub Division</option>
                    </select>
                </div>

                <!-- Urban Fields -->
                <div id="urban-fields" class="hidden">
                    <select id="town-dropdown" class="form-select">
                        <option value="">Select Town</option>
                    </select>

                    <select id="ward-dropdown" class="form-select">
                        <option value="">Select Ward</option>
                    </select>

                    <select id="block-dropdown" class="form-select">
                        <option value="">Select Block</option>
                    </select>

                    <select id="urban-survey-number-dropdown" class="form-select">
                        <option value="">Select Survey Number</option>
                    </select>

                    <select id="urban-sub-division-dropdown" class="form-select">
                        <option value="">Select Sub Division</option>
                    </select>
                </div>
                <div id="goto-fields">
                    <p>Goto option Coming soon</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal -->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="false" data-bs-keyboard="false" focus="false"
        tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h6 class="modal-title fs-6" id="staticBackdropLabel">Land Parcel Information</h6>
                    <button type="button" id="info-close" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body lpi-modal-body" id="lpi-container">
                    <div class="backdrop-loader" style="display: none;">
                          <div class="loader"></div>
                          <p style="color: #fff; text-align: center; margin-top: 30px;">Loading...</p>
                      </div>
                    <!-- <div class="loading-message">Data loading<span class="dots"></span></div> -->

                    <div class="info-section p-0 px-2" id="lpi-content">
                        <div class="district-taluk-village">
                            <div><strong>District:</strong> <br>- / -</div>
                            <div><strong>Taluk:</strong> <br> - / -</div>
                            <div><strong>Village:</strong> <br> - / -</div>
                        </div>
                        
                        <div class="lgd-codes p-0 px-1">
                            <div><strong>Village LGD Code:</strong> - </div>
                        </div>
                        
                        <div class="info-survey-section">
                            <div><strong>ULPIN:</strong><br> - </div>
                            <div><strong>Centroid:</strong><br>-</div>
                            <div><strong>Survey No:</strong><br> -/-</div>
                        </div>
                           
                        <div class="info-icons">

                            <!-- uldabba buttons -->
                            <ul class="nav nav-tabs mb-3 d-flex flex-column" id="myTab" role="tablist">
                                <li class="nav-item mx-1" role="presentation">
                                    <button class="nav-link district-icon" id="profile-tab" type="button"
                                        data-target="#profile-tab-pane" aria-controls="profile-tab-pane"
                                        aria-selected="false">
                                        <i class="bi bi-bank2"></i>
                                    </button>
                                </li>
                                <li class="nav-item mx-1" role="presentation">
                                    <button class="nav-link district-icon" id="next-tab" type="button"
                                        data-target="#next-tab-pane" aria-controls="next-tab-pane"
                                        aria-selected="false">
                                        <i class="bi bi-rulers"></i>
                                    </button>
                                </li>
                                <li class="nav-item mx-1" role="presentation">
                                    <button class="nav-link district-icon" id="pro-tab" type="button"
                                        data-target="#pro-tab-pane" aria-controls="pro-tab-pane" aria-selected="false">
                                        <i class="bi bi-globe"></i>
                                    </button>
                                </li>
                                <li class="nav-item mx-1" role="presentation">
                                    <button class="nav-link district-icon" id="nex-tab" type="button"
                                        data-target="#nex-tab-pane" aria-controls="nex-tab-pane" aria-selected="false">
                                        <!-- <i class="bi bi-currency-rupee"></i> -->
                                        <img src="assets/icons/rubai.svg" id="rubai" alt="">
                                    </button>
                                </li>
                                <li class="nav-item mx-1" role="presentation">
                                    <button class="nav-link district-icon" id="nex-tab" type="button"
                                        data-target="#nex-tab-pane" aria-controls="nex-tab-pane" aria-selected="false">
                                        <!-- <i class="bi bi-currency-rupee"></i> -->
                                        <b>EC</b>
                                    </button>
                                </li>
                                <li class="nav-item mx-1" role="presentation">
                                    <button class="nav-link district-icon" id="nex-tab" type="button"
                                        data-target="#nex-tab-pane" aria-controls="nex-tab-pane" aria-selected="false">
                                        <!-- <i class="bi bi-currency-rupee"></i> -->
                                        <b>JSB</b>
                                    </button>
                                </li>
                                <li class="nav-item mx-1" role="presentation">
                                    <button class="nav-link district-icon" id="nex-tab" type="button"
                                        data-target="#nex-tab-pane" aria-controls="nex-tab-pane" aria-selected="false">
                                        <b>Thematic</b>
                                        
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="alert alert-danger error-message animate__animated animate__fadeInDown" role="alert"></div>
                </div>
            </div>
        </div>
    </div>
    <script>
        
    </script>

    <div id="menu" class="hidden">
        
        <h3>Change Background Map</h3>
        <div class="background-options">
            <button class="basemap-btn" id="osm-btn" onclick="changeBasemap('basemap', 'osm')">OpenStreetMap</button>
            <button class="basemap-btn" id="satellite-btn" onclick="changeBasemap('basemap', 'satellite')">Satellite</button>
            <button class="basemap-btn" id="terrain-btn" onclick="changeBasemap('basemap', 'terrain')">Terrain</button>
        </div>
    </div>
    <div class="more_info">
        <div class="more_info_content">
            <span>Click on the map to know more details</span>
        </div>
    </div>
    <div id="map" class="map"></div>
    <!-- Map Icons -->
    <div id="bottom-left-container">
        <style>
            #bottom-left-container{
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                align-content: center;
                padding: 5px 3rem;
            }
            #bottom-left-container a{
                text-decoration: underline;
                font-weight: 600;
                color: rgb(255, 255, 255);
            }
            #bottom-left-container a:hover{
                text-shadow: 2px 2px 5px white;
            }
        </style>
        <div id="map-icons">
            
            <div class="map-footer">
                <p class="mousePosition mb-2"><i class="bi bi-geo-alt-fill"></i><span id="lat">7.325413164844948</span> ,
                    <span id="lon">76.133061568552585282</span></p>
                
            </div>
        </div>
 
        <div class="ps-2 copyrights">
            <a class="text-white px-2 txt-aligns" data-bs-toggle="modal" data-bs-target=".disclaimer"
                style="cursor: pointer;"><span><i class="bi bi-eye"></i> Disclaimer</span></a>
            <span>Copyright © Designed and developed by <a href="https://tnega.tn.gov.in/" target="_blank">TNeGA&nbsp;<img src="assets/logo/tnega-logo.png" alt="TNGIS Logo" title="TNeGA Logo" class="logo_tnega"></a></span>
        </div>
        <div class="ps-2 copyrights">
            <span class="total_visitors"></span>
            <span class="online_viewer"></span>
        </div>
        <div>
            <span class="text-white">Owned and supported by <a href="https://tnlandsurvey.tn.gov.in/"
                    title="Survey and Settlement Department" target="_blank">Survey and Settlement Department</a> & <a
                    href='https://tnreginet.gov.in/' title="IGR" target="_blank">IGR</a> - GoTN</span>
        </div>
        
        
        <!-- <div>Powered by TNeGA</div> -->
        


    </div>
    <!-- Mao icons -->

    <div id="info-panel" class="info-panel">
        <button id="close-btn" class="close-btn">&times;</button>
        <div id="panel-content">
            <!-- Content dynamically inserted here -->
        </div>
    </div>

    <div id="simplified-info-panel" class="info-panel">
        <button id="simplified-close-btn" class="close-btn">&times;</button>
        <div id="simplified-panel-content">
            <!-- Content dynamically inserted here -->
        </div>
    </div>
    <div id="vertex-info-panel">
        <h3 id="vertex-info-title" style="margin-top: 0;">Vertex Information <button id="close-panel-btn"
                onclick="closeInfoPanel()">&times;</button></h3>
        <div id="vertex-info-content" style="overflow-y: auto; height: calc(100% - 50px);">
            <!-- Content will be dynamically injected here -->
        </div>
    </div>

    <!-- HTML Structure for Areg Info Panel -->
    

    <!-- FMB Sketch Panel -->
    <div id="fmb-sketch-info-panel" style="display: none;">
        <div class="panel-header">
            <span>FMB Sketch</span>
            <button id="fmb-fullscreen-btn"><i class="bi bi-arrows-fullscreen"></i></button>
            <button id="fmb-close-btn" onclick="closeFMBSketchPanel()">&times;</button>
        </div>
        <div class="panel-content">
            <iframe id="fmb-sketch-viewer" style="width: 100%; height: 100%; border: none;"></iframe>
        </div>
    </div>

    <!-- IGR Info Panel -->
    <div id="igr-info-panel">
        <div id="igr-info-panel-header">
            <span>Guideline Value</span>
            <button id="igr-close-btn" onclick="closeIGRInfoPanel()">&times;</button>
        </div>
        <div id="igr-card-content" style="margin-top: 10px;">
            <!-- Card content will be added dynamically -->
        </div>
    </div>

    <!-- Crop Info Panel -->
    <div id="crop-info-panel">
        <div id="crop-info-panel-header">
            <span>Crop Survey Info</span>
            <button id="crop-close-btn" onclick="closeCropInfoPanel()">&times;</button>
        </div>
        <div id="crop-card-content" style="margin-top: 10px;">
            <!-- Card content will be added dynamically -->
        </div>
    </div>



    <!-- disclamier -->
    <div class="modal fade disclaimer" tabindex="-1" aria-labelledby="disclaimer" aria-modal="true" role="dialog">
      <div class="modal-dialog modal-xl modal-dialog-scrollable modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header py-2">
            <h1 id="disclaimer" class="modal-title fs-5 txt-blue"><i class="bi bi-exclamation-circle"></i><span class="ps-2">Disclaimer</span></h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" style="font-size: 12px;">       
            <p id="d1"><i class="bi bi-check2-circle"></i> All boundaries displayed are indicative boundaries. The map boundaries shall not be used for any legal purposes.</p>
            <p id="d2"><i class="bi bi-check2-circle"></i> There are possibilities of FMB sketches not updated in this application wherein the FMB sketches might have got created digitally and may be available in downloads section.</p>
            <p id="d3"><i class="bi bi-check2-circle"></i> If FMB sketches are not available or not updated, contact the respective Taluka surveyor and get them updated in collabland software.</p>
            <p id="d4"><i class="bi bi-check2-circle"></i> In case of any wrong depiction of available FMB sketches, please contact the respective Taluka surveyor for updation.</p>
            <p id="d5"><i class="bi bi-check2-circle"></i> The ownership information displayed are as available in Tamil Nilam database maintained and shared by NIC through API's.</p>
            <p id="d6"><i class="bi bi-check2-circle"></i> Correction / objection to the ownership records or the maps therein should be represented to Department of Survey and Settlements only.</p>
            <p id="d7"><i class="bi bi-check2-circle"></i> The Government, Department nor any Officer of Govt and its representatives can't be held responsible for any loss / damage happened due to the utility / effectiveness of usage of the app and its data contents.</p>
            <p id="d8"><i class="bi bi-check2-circle"></i> The contents are made available to general public as part of its transparency and data utility to general public not for commercial uses.</p>
            <p id="d9"><i class="bi bi-check2-circle"></i> Any commercial use from the data of this app and its derivatives is strictly prohibited.</p>
          </div>
        </div>
      </div>
    </div>
    <!-- disclaimer -->
    
    <script src="assets/js/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="assets/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="assets/js/toastr.min.js"></script>
    <script src="vendor/openlayer/dist/ol.js"></script>
    <script src="assets/js/config.js"></script>
    <script src="assets/js/scripts.js"></script>

    <script>
        $(document).on({
            // ajaxStart: function () {
            //     showSpinner();
            // },
            // ajaxStop: function () {
            //     hideSpinner();
            // },
        });

        // Function to show spinner
        function showSpinner() {
            // Show spinner
            $(".backdrop-loader").show();
            // $(".loading-message").show();
            
        }

        // Function to hide spinner
        function hideSpinner() {
            // Hide spinner
            $(".backdrop-loader").hide();
            // $(".loading-message").hide();
        }
        $(document).ready(function () {
            // console.log("%cWARNING: ADVANCED USERS ONLY", "font-size: 21px; font-weight: bold; color: #FF0000; -webkit-text-stroke: 1px #660000;");
            changeBasemap('basemap', 'satellite');
            // changeBasemap('layer', 'cadastral_xyz');
            map.addLayer(geojsonLayer);
            // districtDropDown();
            // Initial check for visibility
            updateWMSLayerVisibility();

            let isDragging = false;
            let offsetX = 0;
            let offsetY = 0;
            let $currentDialog = null;

            $(document).on('mousedown', '.modal-header', function (e) {
                $currentDialog = $(this).closest('.modal').find('.modal-dialog');

                isDragging = true;
                offsetX = e.clientX - $currentDialog.offset().left;
                offsetY = e.clientY - $currentDialog.offset().top;

                $currentDialog.css('cursor', 'grabbing');
                // Optional: set position to fixed so dragging feels natural
                $currentDialog.css('position', 'fixed');
            });

            $(document).on('mousemove', function (e) {
                if (isDragging && $currentDialog) {
                    const left = e.clientX - offsetX;
                    const top = e.clientY - offsetY;

                    $currentDialog.css({
                        left: left + 'px',
                        top: top + 'px'
                    });
                }
            });

            $(document).on('mouseup', function () {
                if (isDragging && $currentDialog) {
                    isDragging = false;
                    $currentDialog.css('cursor', 'grab');
                    $currentDialog = null;
                }
            });


            $('.nav-link').on('click', function () {
                const target = $(this).data('target');
                const content = $(target);

                // If the clicked tab is already active, hide it
                if ($(this).hasClass('active')) {
                    $(this).removeClass('active').attr('aria-selected', 'false');
                    content.removeClass('show active');
                } else {
                    // Deactivate all tabs and content
                    $('.nav-link').removeClass('active').attr('aria-selected', 'false');
                    $('.tab-pane').removeClass('show active');

                    // Activate the clicked tab and content
                    $(this).addClass('active').attr('aria-selected', 'true');
                    content.addClass('show active');
                }
            });

            
        })

        function populateSelect(selector, data, codeField, nameField, label) {
            var select = $(selector);
            select.empty();
            select.append(`<option value="">-- Select ${label}--</option>`);
            $.each(data, function (index, value) {
                select.append('<option value="' + value[codeField] + '">' + value[nameField] + '</option>');
            });
        }

        function clearGeoJson() {
            geojsonSource.clear();
            geojsonLayer.setVisible(false);
        }

        function fetchGeometry(caseType, districtCode, talukCode, villageCode,survey_number) {
            $.ajax({
                url: `${BASE_URL}/v1/get_geom`,
                method: 'POST',
                headers: {
                    'X-APP-NAME': 'NOC'
                },
                data: {
                    case: caseType,
                    code_type: 'revenue',
                    district_code: districtCode,
                    taluk_code: talukCode,
                    village_code: villageCode,
                    survey_number:survey_number,
                },
                success: function (response) {
                    if (response.success) {
                        var featureCollection = response.data;

                        var features = geojsonFormat.readFeatures(featureCollection, {
                            dataProjection: 'EPSG:4326',
                            featureProjection: 'EPSG:3857'
                        });
                        geojsonSource.clear();
                        geojsonSource.addFeatures(features);

                        var extent = geojsonSource.getExtent();

                        map.getView().fit(extent, {
                            duration: 4000,
                            maxZoom: 15,
                            padding: [20, 20, 20, 20]
                        });
                        geojsonLayer.setVisible(true);

                    } else {
                        console.error(response.message);
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error fetching geometry data:', error);
                }
            });
        }

        function fetchGeometryUrban(caseType, districtCode, talukCode, town_code,ward_code,block_code) {
            $.ajax({
                url: `${BASE_URL}/v1/get_geom`,
                method: 'POST',
                headers: {
                    'X-APP-NAME': 'NOC'
                },
                data: {
                    case: caseType,
                    code_type: 'revenue',
                    district_code: districtCode,
                    taluk_code: talukCode  || 0,
                    town_code: town_code  || 0,
                    ward_code: ward_code  || 0,
                    block_code: block_code || 0,

                },
                success: function (response) {
                    if (response.success) {
                        var featureCollection = response.data;

                        var features = geojsonFormat.readFeatures(featureCollection, {
                            dataProjection: 'EPSG:4326',
                            featureProjection: 'EPSG:3857'
                        });
                        geojsonSource.clear();
                        geojsonSource.addFeatures(features);

                        var extent = geojsonSource.getExtent();

                        map.getView().fit(extent, {
                            duration: 4000,
                            maxZoom: 15,
                            padding: [20, 20, 20, 20]
                        });
                        geojsonLayer.setVisible(true);

                    } else {
                        console.error(response.message);
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error fetching geometry data:', error);
                }
            });
        }


        function fetchGeometrySurvey(caseType, admin_type,districtCode, talukCode, villageCode,townCode,wardCode,blockCode,surveyNumber) {
            $.ajax({
                url: `${BASE_URL}/v1/get_geom`,
                method: 'POST',
                headers: {
                    'X-APP-NAME': 'NOC'
                },
                data: {
                    case: caseType,
                    code_type: 'revenue',
                    district_code: districtCode,
                    taluk_code: talukCode,
                    village_code: villageCode,
                    admin_type:admin_type,
                    town_code:townCode,
                    ward_code:wardCode,
                    block_code:blockCode,
                    survey_number:surveyNumber
                },
                success: function (response) {
                    if (response.success) {
                        var featureCollection = response.data;

                        var features = geojsonFormat.readFeatures(featureCollection, {
                            dataProjection: 'EPSG:4326',
                            featureProjection: 'EPSG:3857'
                        });
                        geojsonSource.clear();
                        geojsonSource.addFeatures(features);

                        var extent = geojsonSource.getExtent();

                        map.getView().fit(extent, {
                            duration: 4000,
                            maxZoom: 15,
                            padding: [20, 20, 20, 20]
                        });
                        geojsonLayer.setVisible(true);

                    } else {
                        console.error(response.message);
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error fetching geometry data:', error);
                }
            });
        }

        

        // script for urban and rural switching
        document.addEventListener("DOMContentLoaded", function () {
            const ruralFields = document.getElementById("rural-fields");
            const urbanFields = document.getElementById("urban-fields");
            const areaTypeRadios = document.querySelectorAll("input[name='area-type']");
            function toggleFields() {
                $("#goto-fields").hide();
                $("#taluk-dropdown").show();
                $("#district-dropdown").show();
                if (document.querySelector("input[name='area-type']:checked").value === "urban") {
                    urbanFields.style.display = "block";
                    ruralFields.style.display = "none";
                } else if(document.querySelector("input[name='area-type']:checked").value === "rural"){
                    ruralFields.style.display = "block";
                    urbanFields.style.display = "none";
                }else{
                    ruralFields.style.display = "none";
                    urbanFields.style.display = "none";
                    $("#taluk-dropdown").hide();
                    $("#district-dropdown").hide();
                    $("#goto-fields").show();
                }
            }

            areaTypeRadios.forEach(radio => {
                radio.addEventListener("change", toggleFields);
            });

            toggleFields();
        });

        // Toggle the 'active' class when 'resetRotation' button is clicked
        document.getElementById('resetRotation').addEventListener('click', function (event) {
            // Select the element with the class 'sub-rotate-btns'
            const rotateBtns = document.querySelector('.sub-rotate-btns');

            // Check if the element exists to avoid errors
            if (rotateBtns) {
                rotateBtns.classList.toggle('active'); // Toggle the 'active' class
            } else {
                console.error('Element with class "sub-rotate-btns" not found.');
            }

            // Stop the click from propagating to the document (prevents it from being immediately removed)
            event.stopPropagation();
        });

        // Add a click event to the document to remove 'active' class if clicked outside
        document.addEventListener('click', function (event) {
            const rotateBtns = document.querySelector('.sub-rotate-btns');

            // If rotateBtns exists and the clicked target is not inside '.sub-rotate-btns' or '#resetRotation', remove 'active'
            if (rotateBtns && !rotateBtns.contains(event.target) && !document.getElementById('resetRotation').contains(event.target)) {
                rotateBtns.classList.remove('active');
            }
        });

        document.addEventListener("DOMContentLoaded", function () {
            const tabs = document.querySelectorAll(".tab");
            const contents = document.querySelectorAll(".tab-content");

            tabs.forEach((tab, index) => {
                tab.addEventListener("click", function () {
                    // Remove active class from all tabs and contents
                    tabs.forEach(t => t.classList.remove("active"));
                    contents.forEach(c => c.classList.add("d-none"));

                    // Add active class to the clicked tab and corresponding content
                    tab.classList.add("active");
                    contents[index].classList.remove("d-none");
                });
            });
        });
        function comingsoon(){
            alert("Coming soon");
        }

    </script>
    <script>
    $(document).ready(function () {
        $("#year").text(new Date().getFullYear());
        

        
    }); 
    
    </script>
    
</body>

</html>